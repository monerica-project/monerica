@model DirectoryManager.Web.Models.DirectoryEntryEditViewModel
@inject DirectoryManager.Web.Services.Interfaces.ICacheService cacheHelper
@using DirectoryManager.Data.Enums
@using DirectoryManager.Web.Constants;

<div class="form-group">
    <label asp-for="DirectoryStatus">Status</label>
    <select asp-for="DirectoryStatus" asp-items="@Html.GetEnumSelectList<DirectoryStatus>()"></select>
</div>

<div class="form-group">
    <label asp-for="SubCategoryId">Subcategory</label>
    <select asp-for="SubCategoryId" asp-items="@(new SelectList(ViewBag.SubCategories, "SubcategoryId", "DisplayName"))" required></select>
</div>

<div class="form-group">
    <label asp-for="Name">Name</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="Name" required />
</div>

<div class="form-group">
    <label asp-for="Link">Link</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="Link" required />
</div>

<div class="form-group">
    <label asp-for="LinkA">Link (affiliate)</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="LinkA" />
</div>

<div class="form-group">
    <label asp-for="Link2">@await cacheHelper.GetSnippetAsync(SiteConfigSetting.Link2Name)</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="Link2" />
</div>

<div class="form-group">
    <label asp-for="Link2A">@await cacheHelper.GetSnippetAsync(SiteConfigSetting.Link2Name) (affiliate 2)</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="Link2A" />
</div>

<div class="form-group">
    <label asp-for="Link3">@await cacheHelper.GetSnippetAsync(SiteConfigSetting.Link3Name)</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="Link3" />
</div>

<div class="form-group">
    <label asp-for="Link3A">@await cacheHelper.GetSnippetAsync(SiteConfigSetting.Link3Name) (affiliate 3)</label>
    <input autocomplete="off"  class="input-width" type="text" asp-for="Link3A" />
</div>

<div class="form-group">
    <label asp-for="ProofLink">Proof Link</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="ProofLink" />
</div>

<div class="form-group">
    <label asp-for="VideoLink">Video Link</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="VideoLink" />
</div>

<div class="form-group">
    <label asp-for="Location">Location</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="Location" />
</div>

<div class="form-group">
    <label asp-for="CountryCode" class="control-label"></label>
    <select asp-for="CountryCode" asp-items="ViewBag.CountryCode" class="form-control"></select>
    <span asp-validation-for="CountryCode" class="text-danger"></span>
</div>

<div class="form-group">
    <label asp-for="Processor">Processor</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="Processor" />
</div>

<div class="form-group">
    <label asp-for="Contact">Contact</label>
    <input autocomplete="off" class="input-width" type="text" asp-for="Contact" />
</div>

<div class="form-group">
    <label asp-for="Description">Description</label>
    <textarea rows="4" class="input-width" asp-for="Description"></textarea>
</div>

<div class="form-group">
    <label asp-for="Note">Note</label>
    <textarea rows="4" class="input-width" asp-for="Note"></textarea>
</div>

<div class="form-group">
    <label asp-for="PgpKey">PGP Key</label>
    <textarea rows="4" class="input-width" asp-for="PgpKey"></textarea>
</div>

@{
    var allTags = ViewBag.AllTags as List<DirectoryManager.Web.Models.TagOptionVm>
                 ?? new List<DirectoryManager.Web.Models.TagOptionVm>();

    var selected = ViewBag.SelectedTagIds as HashSet<int> ?? new HashSet<int>();
}
 


@{

    // Ensure list has at least 3 slots for UI
    var additional = (Model.AdditionalLinks ?? new List<string>());
    while (additional.Count < DirectoryManager.Web.Constants.IntegerConstants.MaxAdditionalLinks)
    {
        additional.Add(string.Empty);
    }
}

<hr />
<h3>Additional Links (forum post, docs, references)</h3>
<p class="small-font"><i>Optional. These are NOT Tor/I2P links. Examples: forum thread, announcement, docs page.</i></p>

@if (Model.AdditionalLinks != null && Model.AdditionalLinks.Any(x => !string.IsNullOrWhiteSpace(x)))
{
    <br />
    <b>Additional Links:</b>
    <ul>
        @foreach (var l in Model.AdditionalLinks.Where(x => !string.IsNullOrWhiteSpace(x)))
        {
            <li><a target="_blank" href="@l">@l</a></li>
        }
    </ul>
}


@for (int i = 0; i < DirectoryManager.Web.Constants.IntegerConstants.MaxAdditionalLinks; i++)
{
    <div class="form-group">
        <label>Additional Link @(i + 1)</label>
        <input autocomplete="off"
               class="input-width"
               type="text"
               name="AdditionalLinks[@i]"
               value="@additional[i]" />
    </div>
}


<div class="form-group">
    <label><b>Tags (existing)</b></label>

    @if (allTags.Count == 0)
    {
        <p><i>No tags exist yet.</i></p>
    }
    else
    {
        <div class="tag-grid">
            @foreach (var t in allTags)
            {
                var isChecked = selected.Contains(t.TagId) || (Model.SelectedTagIds?.Contains(t.TagId) ?? false);

                <label class="tag-pill">
                    <input type="checkbox"
                           name="SelectedTagIds"
                           value="@t.TagId"
                           @(isChecked ? "checked" : "") />
                    <span>@t.Name</span>
                </label>
            }
        </div>
    }
</div>

<div class="form-group">
    <label asp-for="NewTagsCsv">New Tags (optional, comma-separated)</label>
    <input asp-for="NewTagsCsv" class="input-width form-control"
           placeholder="e.g. privacy, wallet, exchange" />
    <span asp-validation-for="NewTagsCsv" class="text-danger"></span>
</div>
