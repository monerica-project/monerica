@using DirectoryManager.Data.Enums
@using DirectoryManager.Web.Services.Interfaces
@inject DirectoryManager.Web.Services.Interfaces.ICacheService cacheHelper
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor httpContextAccessor
@inject IUrlResolutionService urlResolver

@{
    // Fetch logo URL
    var rawUrl = await cacheHelper.GetSnippetAsync(SiteConfigSetting.SiteLogoUrl);

    // 🚫 No logo? Stop here.
    if (string.IsNullOrWhiteSpace(rawUrl))
    {
        return;
    }

    // Strip domain if absolute
    string logoPath = rawUrl;
    if (Uri.TryCreate(rawUrl, UriKind.Absolute, out var uri))
    {
        logoPath = uri.PathAndQuery;
    }

    var root = await cacheHelper.GetSnippetAsync(SiteConfigSetting.FullRootUrl);
    var isOnTor =
        httpContextAccessor.HttpContext?.Request.Host.Host
            .EndsWith(DirectoryManager.Web.Constants.StringConstants.TorDomain) ?? false;

    var href = (isOnTor || string.IsNullOrWhiteSpace(root) || urlResolver.IsLocal)
        ? Url.Content("~/")
        : root;
}

<a class="no-app-link" href="@href">
    <img src="@logoPath"
         alt="Logo"
         class="site-logo-top-right" />
</a>
