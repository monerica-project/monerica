@using DirectoryManager.Data.Enums
@using DirectoryManager.Web.Services.Interfaces
@inject DirectoryManager.Web.Services.Interfaces.ICacheService cacheHelper
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor httpContextAccessor
@inject IUrlResolutionService urlResolver
@{
    var rawUrl = await cacheHelper.GetSnippetAsync(SiteConfigSetting.SiteLogoUrl);

    // Default to raw value if parsing fails
    string logoPath = rawUrl;

    if (!string.IsNullOrWhiteSpace(rawUrl) &&
        Uri.TryCreate(rawUrl, UriKind.Absolute, out var uri))
    {
        logoPath = uri.PathAndQuery; // strips scheme + domain
    }
}
 
@{
    var root = await cacheHelper.GetSnippetAsync(SiteConfigSetting.FullRootUrl);
    var isOnTor = httpContextAccessor.HttpContext?.Request.Host.Host.EndsWith(DirectoryManager.Web.Constants.StringConstants.TorDomain) ?? false;

    if (isOnTor || string.IsNullOrWhiteSpace(root) || urlResolver.IsLocal)
    {
        <a class="no-app-link" href="~/"><img src="@logoPath"
                 alt="Logo"
                 class="site-logo-top-right" /></a>
    }
    else
    {
        <a class="no-app-link" href="@root"><img src="@logoPath"
                 alt="Logo"
                 class="site-logo-top-right" /></a>
    }
}