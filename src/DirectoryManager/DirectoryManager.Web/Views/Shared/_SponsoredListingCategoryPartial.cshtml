@model DirectoryManager.Web.Models.CategorySponsorModel
@using DirectoryManager.Web.Constants
@using DirectoryManager.Data.Enums
@using DirectoryManager.Web.Services.Interfaces
@inject ICacheService _cacheHelper

@{
    var link2Name = await _cacheHelper.GetSnippetAsync(SiteConfigSetting.Link2Name);
    var link3Name = await _cacheHelper.GetSnippetAsync(SiteConfigSetting.Link3Name);

    var categoryId = Model?.CategoryId ?? 0;
    var advertiseHref = Url.Content($"~/sponsoredlisting/selectlisting?categoryId={categoryId}&sponsorshipType={SponsorshipType.CategorySponsor}");

    var vm = Model?.DirectoryEntry; // DisplayFormatting.Models.DirectoryEntryViewModel
}

@if (vm is not null)
{
    // Ensure link labels exist (Tor/I2P labels etc.)
    vm.Link2Name = string.IsNullOrWhiteSpace(vm.Link2Name) ? link2Name : vm.Link2Name;
    vm.Link3Name = string.IsNullOrWhiteSpace(vm.Link3Name) ? link3Name : vm.Link3Name;

    // Ensure it behaves like a sponsor listing
    vm.IsSponsored = true;
    vm.DisplayAsSponsoredItem = false;

    // Category sponsor (NOT subcategory sponsor)
    vm.IsSubCategorySponsor = false;

    // Category sponsor should be a direct outbound link
    vm.LinkType = DirectoryManager.DisplayFormatting.Enums.LinkType.Direct;

    <div class="sponsored-section" style="margin-bottom:5px;">
        <p><b>Sponsored</b></p>
        <ul class="blank_list_item">
            @await Html.PartialAsync("_DirectoryEntryPartial", vm)
        </ul>
    </div>
}
else
{
    <p class="category-sponsored-listing">
        <a class="app-link" rel="nofollow" href="@advertiseHref">Advertise here</a>
    </p>
}
