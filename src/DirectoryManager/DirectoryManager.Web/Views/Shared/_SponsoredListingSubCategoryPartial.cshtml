@using DirectoryManager.Web.Constants
@using DirectoryManager.Data.Enums
@inject DirectoryManager.Web.Services.Interfaces.ICacheService _cacheHelper
@model DirectoryManager.Web.Models.SubcategorySponsorModel

@{
    var link2Name = await _cacheHelper.GetSnippetAsync(SiteConfigSetting.Link2Name);
    var link3Name = await _cacheHelper.GetSnippetAsync(SiteConfigSetting.Link3Name);

    var vm = Model?.DirectoryEntry; // this is DisplayFormatting.Models.DirectoryEntryViewModel
}

@if (Model != null && vm != null)
{
    // Ensure link labels exist
    vm.Link2Name = string.IsNullOrWhiteSpace(vm.Link2Name) ? link2Name : vm.Link2Name;
    vm.Link3Name = string.IsNullOrWhiteSpace(vm.Link3Name) ? link3Name : vm.Link3Name;

    // Ensure sponsor behavior
    vm.IsSponsored = true;
    vm.DisplayAsSponsoredItem = false;
    vm.IsSubCategorySponsor = true;

    // Keep whatever you’re using on subcategory pages (you set ListingPage in the page)
    // vm.LinkType = DirectoryManager.DisplayFormatting.Enums.LinkType.ListingPage;

    <div class="sponsored-section">
        <p><b>Sponsored</b></p>
        <ul class="blank_list_item">
            @await Html.PartialAsync("_DirectoryEntryPartial", vm)
        </ul>
    </div>
}
else if (Model != null && Model.TotalActiveSubCategoryListings >= DirectoryManager.Common.Constants.IntegerConstants.MinRequiredSubcategories)
{
    <p class="sub-category-sponsored-listing">
        <a class="app-link"
           rel="nofollow"
           href="~/sponsoredlisting/selectlisting?subCategoryId=@Model.SubCategoryId&sponsorshipType=@SponsorshipType.SubcategorySponsor">
            Advertise here
        </a>
    </p>
}
